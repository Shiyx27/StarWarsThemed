<--everything is here cause it's a small function -->
{% extends "base.html" %}
{% block title %}Gallery{% endblock %}
{% block body %}
<div class="container">
  <h1 class="neon">üì∏ Gallery</h1>
  <div class="grid" id="gallery">
    {% for img in images %}
      <div class="card">
        <img 
          src="{{ url_for('static', filename='images/captured/' + img) }}" 
          data-index="{{ loop.index0 }}"
          class="thumb"
          alt="Photo {{ loop.index }}"
        >
        <a class="btn small" href="{{ url_for('download', filename=img) }}">‚¨á Download</a>
      </div>
    {% else %}
      <p>No photos yet.</p>
    {% endfor %}
  </div>
</div>

<!-- Lightbox overlay -->
<div id="lightbox" class="lightbox hidden">
  <!-- Home button -->
  <a href="{{ url_for('index') }}" class="btn home-btn">üè† Home</a>
  <img class="lightbox-img" id="lb-img" src="" alt="">
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const gallery = Array.from(document.querySelectorAll('#gallery .thumb'));
    const lightbox = document.getElementById('lightbox');
    const lbImg    = document.getElementById('lb-img');
    let currentIndex = 0;

    function showLightbox(idx) {
      const imgEl = gallery[idx];
      lbImg.src = imgEl.src;
      currentIndex = idx;
      lightbox.classList.remove('hidden');
    }

    function hideLightbox() {
      lightbox.classList.add('hidden');
    }

    // Open lightbox on thumbnail click
    gallery.forEach((imgEl, idx) => {
      imgEl.addEventListener('click', () => showLightbox(idx));
    });

    // Close on click outside image or on ESC
    lightbox.addEventListener('click', e => {
      if (e.target === lightbox) hideLightbox();
    });
    document.addEventListener('keydown', e => {
      if (!lightbox.classList.contains('hidden') && e.key === 'Escape') {
        hideLightbox();
      }
    });
  });
</script>
<style>
  /* Lightbox styles */
  .lightbox {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 1000;
  }
  .lightbox.hidden { display: none; }
  .lightbox-img {
    max-width: 90%;
    max-height: 80%;
  }
  .home-btn {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 1001;
  }
</style>
{% endblock %}
